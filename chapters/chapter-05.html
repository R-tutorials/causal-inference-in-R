<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.4.358" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />


<title>Causal Inference in R – 5  Expressing causal questions as DAGs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script defer data-domain="r-causal.org" src="https://plausible.io/js/script.js"></script>


</head>

<body>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn"
      data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" 
      aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
      onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <h1 class="quarto-secondary-nav-title no-breadcrumbs"></h1>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" 
        aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
        onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="/">
      Causal Inference in R
      </a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/malcolmbarrett/causal-inference-in-r"  title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Asking Causal Questions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>1</span>  <span class='chapter-title'>What is a causal question?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>2</span>  <span class='chapter-title'>The whole game: mosquito nets and malaria</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>3</span>  <span class='chapter-title'>Estimating counterfactuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>4</span>  <span class='chapter-title'>Target Trials and Standard Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-05.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class='chapter-number'>5</span>  <span class='chapter-title'>Expressing causal questions as DAGs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">The Design Phase</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>6</span>  <span class='chapter-title'>Preparing data to answer causal questions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>7</span>  <span class='chapter-title'>Building propensity score models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>8</span>  <span class='chapter-title'>Using the propensity score</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>9</span>  <span class='chapter-title'>Evaluating your propensity score model</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Estimating Causal Effects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>10</span>  <span class='chapter-title'>Causal estimands</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>11</span>  <span class='chapter-title'>Fitting the outcome model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>12</span>  <span class='chapter-title'>Continuous exposures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>13</span>  <span class='chapter-title'>Categorical exposures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>14</span>  <span class='chapter-title'>Missingness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>15</span>  <span class='chapter-title'>G-Computation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-16.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>16</span>  <span class='chapter-title'>Causal survival analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-17.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>17</span>  <span class='chapter-title'>Causal mediation analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-18.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>18</span>  <span class='chapter-title'>Sensitivity analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/chapter-19.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class='chapter-number'>19</span>  <span class='chapter-title'>Other approaches to causal inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/chapters/references-99.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" ></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-dags" class="quarto-section-identifier"><span class="chapter-number">5</span>  <span class="chapter-title">Expressing causal questions as DAGs</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#visualizing-causal-assumptions" id="toc-visualizing-causal-assumptions"><span class="header-section-number">5.1</span> Visualizing Causal Assumptions</a></li>
  <li><a href="#dags-in-r" id="toc-dags-in-r"><span class="header-section-number">5.2</span> DAGs in R</a></li>
  <li><a href="#structures-of-causality" id="toc-structures-of-causality"><span class="header-section-number">5.3</span> Structures of Causality</a>
  <ul>
  <li><a href="#advanced-confounding" id="toc-advanced-confounding"><span class="header-section-number">5.3.1</span> Advanced Confounding</a></li>
  <li><a href="#selection-bias-and-mediation" id="toc-selection-bias-and-mediation"><span class="header-section-number">5.3.2</span> Selection Bias and Mediation</a></li>
  </ul></li>
  <li><a href="#m-bias-and-butterfly-bias" id="toc-m-bias-and-butterfly-bias"><span class="header-section-number">5.4</span> M-Bias and Butterfly Bias</a></li>
  <li><a href="#causes-of-the-exposure-causes-of-the-outcome" id="toc-causes-of-the-exposure-causes-of-the-outcome"><span class="header-section-number">5.5</span> Causes of the exposure, causes of the outcome</a></li>
  <li><a href="#recommendations-in-building-dags" id="toc-recommendations-in-building-dags"><span class="header-section-number">5.6</span> Recommendations in building DAGs</a>
  <ul>
  <li><a href="#iterate-early-and-often" id="toc-iterate-early-and-often"><span class="header-section-number">5.6.1</span> Iterate early and often</a></li>
  <li><a href="#consider-your-question" id="toc-consider-your-question"><span class="header-section-number">5.6.2</span> Consider your question</a></li>
  <li><a href="#chapter-05-sec-time-ordered" id="toc-chapter-05-sec-time-ordered"><span class="header-section-number">5.6.3</span> Order nodes by time</a></li>
  <li><a href="#consider-the-whole-data-collection-process" id="toc-consider-the-whole-data-collection-process"><span class="header-section-number">5.6.4</span> Consider the whole data collection process</a></li>
  <li><a href="#include-variables-you-dont-have" id="toc-include-variables-you-dont-have"><span class="header-section-number">5.6.5</span> Include variables you don’t have</a></li>
  <li><a href="#saturate-your-dag-then-prune" id="toc-saturate-your-dag-then-prune"><span class="header-section-number">5.6.6</span> Saturate your DAG then prune</a></li>
  <li><a href="#include-instruments-and-competing-exposures" id="toc-include-instruments-and-competing-exposures"><span class="header-section-number">5.6.7</span> Include instruments and competing exposures</a></li>
  <li><a href="#focus-on-the-causal-structure-then-consider-measurement-bias" id="toc-focus-on-the-causal-structure-then-consider-measurement-bias"><span class="header-section-number">5.6.8</span> Focus on the causal structure, then consider measurement bias</a></li>
  <li><a href="#be-accurate-but-focus-on-clarity" id="toc-be-accurate-but-focus-on-clarity"><span class="header-section-number">5.6.9</span> Be accurate, but focus on clarity</a></li>
  <li><a href="#pick-adjustment-sets-most-likely-to-be-succesful" id="toc-pick-adjustment-sets-most-likely-to-be-succesful"><span class="header-section-number">5.6.10</span> Pick adjustment sets most likely to be succesful</a></li>
  <li><a href="#use-robustness-checks" id="toc-use-robustness-checks"><span class="header-section-number">5.6.11</span> Use robustness checks</a></li>
  </ul></li>
  <li><a href="#chapter-05-sec-quartets" id="toc-chapter-05-sec-quartets"><span class="header-section-number">5.7</span> Causal Inference is not (just) a statistical problem</a>
  <ul>
  <li><a href="#chapter-05-sec-causal-pred-revisit" id="toc-chapter-05-sec-causal-pred-revisit"><span class="header-section-number">5.7.1</span> Causal and Predictive Models, Revisited</a></li>
  </ul></li>
  </ul>
</nav>
<section id="visualizing-causal-assumptions" class="level2" data-number="5.1">
<h2 data-number="5.1"><span class="header-section-number">5.1</span> Visualizing Causal Assumptions</h2>
<blockquote>
<p>Draw your assumptions before your conclusions –<span class="citation" data-cites="hernan2021">Hernán and Robins (<a href="#ref-hernan2021" role="doc-biblioref">2021</a>)</span></p>
</blockquote>
<p>Causal diagrams are a tool to visualize your assumptions about the causal structure of the questions you’re trying to answer. In a randomized experiment, the causal structure is quite simple: while there may be many causes of an outcome, the only cause of the exposure is the randomization process itself (we hope!). In many non-randomized settings, however, the structure of your question can be a complex web of causality. Causal diagrams help communicate what we think this structure looks like. In addition to being open about what we think the causal structure is, causal diagrams have incredible mathematics properties that allow us to identify a way to estimate unbiased causal effects even with observational data.</p>
<p>Causal diagrams are also increasingly common. Data collected as a review of the use of causal diagrams in applied health research papers show a drastic increase in use over time <span class="citation" data-cites="Tennant2021">(<a href="#ref-Tennant2021" role="doc-biblioref">Tennant et al. 2020</a>)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-usage" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-dag-usage-1.png" class="img-fluid" width="672" /></p>
<figcaption>Figure 5.1: Percentage of health research papers using causal diagrams over time.</figcaption>
</figure>
</div>
</div>
</div>
<p>The type of causal diagrams we use are also called directed acyclic graphs (DAGs). These graphs are directed because they include arrows going in a specific direction. They’re acyclic because they don’t go in circles; a variable can’t cause itself, for instance. DAGs are used for a wide variety of problems, but we’re specificaly concerned with <em>causal</em> DAGs. This class of DAGs is also sometimes referred to as Structural Causal Models (SCMs) because they are a model of the causal structure of a question.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
DAGs down under
</div>
</div>
<div class="callout-body-container callout-body">
<p>We highly recommend asking an Australian friend about DAGs.</p>
</div>
</div>
<p>DAGs depict causal relationships between variables. Visually, the way they depict variables is as <em>edges</em> and <em>nodes</em>. Edges are the arrows going from one variable to another, also sometimes called arcs or just arrows. Nodes are the variables themselves, sometimes called vertices, points, or just variables. in <a href="#fig-dag-basic" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-dag-basic</span></a>, there are two nodes: <code>x</code> and <code>y</code> and one edge going from <code>x</code> to <code>y</code>. Here, we are saying that <code>x</code> causes <code>y</code>. In some capacity, <code>y</code> “listens” to <code>x</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-basic" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-dag-basic-1.png" class="img-fluid" width="288" /></p>
<figcaption>Figure 5.2: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>If we’re interested in the causal effect of <code>x</code> on <code>y</code>, we’re trying to estimate a numeric representation of that arrow. Usually, though, there are many other variables and arrows in the causal structure of a given question. A series of arrows is called a <em>path</em>. There are three types of paths you’ll see in DAGs: forks, chains, and colliders (sometimes called inverse forks).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-path-types" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-dag-path-types-1.png" class="img-fluid" width="672" /></p>
<figcaption>Figure 5.3: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>Forks represent a common cause of two variables. Here, we’re saying that <code>q</code> causes both <code>x</code> and <code>y</code>. This is the traditional definition of a confounder. They’re called forks because the arrows from <code>x</code> to <code>y</code> are in different directions. Chains, on the other hand, represent a series of arrows going in the same direction. Here <code>q</code> is called a <em>mediator</em>: it is along the causal path from <code>x</code> to <code>y</code>. In this diagram, the only path from <code>x</code> to <code>y</code> is the one mediated through <code>q</code>. Finally, a collider is a path where two arrowheads meet at a variable. Because causality always goes forward in time, this naturally means that the collider variable is caused by two other variables. Here, we’re saying that <code>x</code> and <code>y</code> both cause <code>q</code>.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Are DAGs SEMs?
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re familiar with structural equation models (SEMs), a modeling technique commonly used in psychology and other social science settings, you may notice some similarities between SEMs and DAGs. In fact, DAGs are a form of <em>non-parametric</em> SEM. SEMs estimate entire graphs using parametric assumptions. Causal DAGs, on the other hand, don’t estimate anything; an arrow going from one variable to another says nothing about the strength or functional form of that relationship, only that we think it exists.</p>
</div>
</div>
<p>One of the major benefits of DAGs is that they help us identify sources of bias and, often, provide clues in how to address them. However, talking about an unbiased effect estimate only makes sense when we have a specific causal question in mind. Since each arrow represents a cause, it’s causality all the way down, so no individual arrow is inherently problematic. Here, we’re interested in the effect of <code>x</code> on <code>y</code>. This question defines which paths we’re interested in and which we’re not.</p>
<p>These three types of paths have different implications for the statistical relationship between <code>x</code> and <code>y</code>. If we only look at the correlation between the two variables under these assumptions:</p>
<ol type="1">
<li>In the fork, <code>x</code> and <code>y</code> will be associated, despite there being no arrow from <code>x</code> to <code>y</code>.</li>
<li>In the chain, <code>x</code> and <code>y</code> are related but only through <code>q</code>.</li>
<li>In the collider, <code>x</code> and <code>y</code> will <em>not</em> be related.</li>
</ol>
<p>Paths that transmit association are called <em>open paths</em>. Paths that do not transmit association are called <em>closed paths</em>. Forks and chains are open while colliders are closed.</p>
<p>So, should we adjust for <code>q</code>? That depends on the nature of the path. Forks are confounding paths. Because <code>q</code> causes both <code>x</code> and <code>y</code>, <code>x</code> and <code>y</code> will have a spurious association. They both contain information from <code>q</code>, their mutual cause, and that mutual causal relationship makes <code>x</code> and <code>y</code> associated statistically. Adjusting for <code>q</code> will <em>block</em> the bias from confounding and give us the true relationship between <code>x</code> and <code>y</code>.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Adjustment
</div>
</div>
<div class="callout-body-container callout-body">
<p>We can use a variety of techniques to account for a variable. We use the term “adjustment” to generally refer to any technique that removes the effect of variables we’re not interested in.</p>
</div>
</div>
<p><a href="#fig-confounder-scatter" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-confounder-scatter</span></a> depicts this effect visually. Here, <code>x</code> and <code>y</code> are continuous, and by definition of the DAG, they are unrelated. <code>q</code>, however, causes both. The unadjusted effect is biased because it includes information about the open path from <code>x</code> to <code>y</code> via <code>z</code>. Within levels of <code>z</code>, however, <code>x</code> and <code>y</code> are unrelated.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-confounder-scatter" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-confounder-scatter-1.png" class="img-fluid" width="672" /></p>
<figcaption>Figure 5.4: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>For chains, whether or not we adjusting for mediators depends on the research question. Here, adjusting for <code>q</code> would result in a null estimate of the effect of <code>x</code> on <code>y</code>. Because the only effect of <code>x</code> on <code>y</code> is via <code>q</code>, no other effect remains. The effect of <code>x</code> on <code>y</code> mediated by <code>q</code> is called the <em>indirect</em> effect, while the effect of <code>x</code> on <code>y</code> directly is called the <em>direct</em> effect. If we’re only interested in the direct effect, controlling for <code>q</code> might be what we want. If we want to know about both effects, we shouldn’t try to adjust for <code>q</code>. We’ll learn more estimating different mediation effects in <a href="#sec-mediation" class="quarto-xref"><span class="quarto-unresolved-ref">sec-mediation</span></a>.</p>
<p><a href="#fig-mediator-scatter" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-mediator-scatter</span></a> shows this effect visually. The unadjusted effect of <code>x</code> on <code>y</code> represents the total effect. Since the total effect is due entirely to the path mediated by <code>q</code>, when we adjust for <code>q</code>, no relationship remains. This is the direct effect. Neither of these effects is due to bias but rather each answers a different research question.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-mediator-scatter" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-mediator-scatter-1.png" class="img-fluid" width="672" /></p>
<figcaption>Figure 5.5: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>Colliders are different. In the collider DAG of <a href="#fig-dag-path-types" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-dag-path-types</span></a>, <code>x</code> and <code>y</code> are <em>not</em> associated, but both cause <code>q</code>. Adjusting for <code>q</code> has the opposite effect than with confounding: it <em>opens</em> a biasing pathway. Sometimes, people draw the path opened up by conditioning on a collider connecting <code>x</code> and <code>y</code>.</p>
<p>Visually, we can see this happen when <code>x</code> and <code>y</code> are continuous and <code>q</code> is binary. In <a href="#fig-collider-scatter" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-collider-scatter</span></a>, when we don’t include <code>q</code>, we find there is no relationship between <code>x</code> and <code>y</code>. That’s the correct result. However, when we include <code>q</code>, we can detect information about both <code>x</code> and <code>y</code>, and they appear correlated: across levels of <code>x</code>, those with <code>q = 0</code> have lower levels of <code>y</code>. Association seemingly flows back in time. Of course, that can’t happen from a causal perspective, so controlling for <code>q</code> is the wrong thing to do. We end up with a biased effect of <code>x</code> on <code>y</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-collider-scatter" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-collider-scatter-1.png" class="img-fluid" width="672" /></p>
<figcaption>Figure 5.6: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>How can this be? Since <code>x</code> and <code>y</code> happen before <code>q</code>, <code>q</code> can’t have an impact on them. Let’s turn the DAG on its side and consider <a href="#fig-collider-time" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-collider-time</span></a>. If we break down the two time points, at time point 1, <code>q</code> hasn’t happened yet, and <code>x</code> and <code>y</code> are unrelated. At time point 2, <code>q</code> happens due to <code>x</code> and <code>y</code>. But causality only goes forward in time. <code>q</code> happening later can’t change the fact that <code>x</code> and <code>y</code> happened independently at time point 1.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-collider-time" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-collider-time-1.png" class="img-fluid" width="672" /></p>
<figcaption>Figure 5.7: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>Causality only goes forward. Association, however, is time-agnostic. It’s just an observation about the numerical relationships between variables. When we control for the future, we run the risk of introducing bias. It’s challenging to develop an intuition for this. Consider a case where <code>x</code> and <code>y</code> are the only causes of <code>q</code>, and all three variables are binary. When <em>either</em> <code>x</code> or <code>y</code> equals 1, then <code>q</code> happens. If we know <code>q = 1</code> and <code>x = 0</code> then logically it must be that <code>y = 1</code>. Thus, knowing about <code>q</code> gives us information about <code>y</code> via <code>x</code>. This is an extreme example, but it shows how this type of bias, sometimes called <em>collider-stratification bias</em> or <em>selection bias</em>, occurs: conditioning on <code>q</code> provides statistical information about <code>x</code> and <code>y</code> and distorts their relationship.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Exchangability revisited
</div>
</div>
<div class="callout-body-container callout-body">
<p>We commonly refer exchangability as the assumption of no confounding. Actually, this isn’t quite right. It’s the assumption of no <em>open, non-causal</em> paths. Many times, these are confounding pathways. However, paths can also be opened by conditioning on a collider. Even though these aren’t confounders, it creates non-exchangability between the two groups: they are different in a way that matters to the exposure and outcome.</p>
<p>Open, non-causal paths are also called <em>backdoor paths</em>. We’ll use this terminology often because it captures the idea well: these are any open paths that are biasing the effect we’re interested in estimating</p>
</div>
</div>
<p>Correctly identifying the causal structure between the exposure and outcome thus helps us 1) communicate the assumptions we’re making about the relationships between variables and 2) identify sources of bias. Importantly, in doing 2), we are also often able to identify ways to prevent bias based on the assumptions in 1). In the simple case of three DAGs in <a href="#fig-dag-path-types" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-dag-path-types</span></a>, we know whether or not to control for <code>q</code> depending on the nature of the causal structure. The set or sets of variables we need to adjust for is called the <em>adjustment set</em>. DAGs can help us identify adjustment sets even in complex settings.</p>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
What about interaction?
</div>
</div>
<div class="callout-body-container callout-body">
<p>DAGs don’t make a statement about interaction or effect estimate modification even though they are an important part of inference. Technically, interaction is a matter of the functional form of the relationships in the DAG. Much as we don’t need to specify how we’re going to model a variable in the DAG (e.g., with splines), we don’t need to specify how variables statistically interact with one another. That’s a matter for the modeling stage.</p>
<p>There are several ways we use interactions in causal inference. In one extreme, they are simply a matter of functional form: interaction terms are included in models but marginalized over to get an overall causal effect. In the other extreme, we’re interested in <em>joint causal effects</em>, where the two variables interacting with each other are both causal. In between, we can use interaction terms to identify <em>heterogenous causal effects</em>, effects which vary by a second variable that is not assumed to be causal. As with many tools in causal inference, we use the same statistical technique many ways to answer different questions.</p>
<!-- TODO: expand on this later in the book and link to chapter where we'll discuss -->
<p>Many people have tried ways of expressing interaction in DAGs using different types of arcs, nodes, and other annotations, but no approach has taken off as the preferred way.</p>
</div>
</div>
<p>Let’s take a look at an example in R. We’ll learn how to build DAGs, visualize them, and identify important information like adjustment sets.</p>
</section>
<section id="dags-in-r" class="level2" data-number="5.2">
<h2 data-number="5.2"><span class="header-section-number">5.2</span> DAGs in R</h2>
<p>First, let’s consider the a research question: Does listening to a comedy podcast the morning before an exam improve graduate students test scores? We can diagram this using the method describe in <a href="#sec-diag" class="quarto-xref"><span class="quarto-unresolved-ref">sec-diag</span></a> (<a href="#fig-diagram-podcast" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-diagram-podcast</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-diagram-podcast" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="../images/podcast-diagram.png" class="img-fluid" width="2267" /></p>
<figcaption>Figure 5.8: Does listening to a comedy podcast the morning before an exam improve graduate student test scores?</figcaption>
</figure>
</div>
</div>
</div>
<p>The main tool we’ll use for making DAGs is ggdag. ggdag is a package that connects ggplot2, the most powerful visualization tool in R, to dagitty, an R package with sophisticated algorithms for querying DAGs.</p>
<p>To create a DAG object, we’ll use the <code>dagify()</code> function.<code>dagify()</code> returns a <code>dagitty</code> object that works with both the dagitty and ggdag packages. The <code>dagify()</code> function takes formulas, separated by commas, that specify causes and effects, with the left element of of the formula specifying the effect and the right all of the factors that cause it. This is just like the type of formula we specify for most regression models in R.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  effect1 <span class="sc">~</span> cause1 <span class="sc">+</span> cause2 <span class="sc">+</span> cause3,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  effect2 <span class="sc">~</span> cause1 <span class="sc">+</span> cause4,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>What are all of the factors that cause graduate students to listen to a podcast the morning before an exam? What are all of the factors that could cause a graduate student to do well on a test? Let’s posit some here.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  podcast <span class="sc">~</span> mood <span class="sc">+</span> humor <span class="sc">+</span> prepared,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  exam <span class="sc">~</span> mood <span class="sc">+</span> prepared</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dag {
exam
humor
mood
podcast
prepared
humor -&gt; podcast
mood -&gt; exam
mood -&gt; podcast
prepared -&gt; exam
prepared -&gt; podcast
}</code></pre>
</div>
</div>
<p>In the code above, we assume that:</p>
<ul>
<li>a graduate student’s mood, sense of humor, and how prepared they feel for the exam could influence whether they listened to a podcast the morning of the test</li>
<li>their mood and how prepared they are also influences their exam score</li>
</ul>
<p>Notice we <em>do not</em> see podcast in the exam equation; this means that we assume that there is <strong>no</strong> causal relationship between podcast and the exam score.</p>
<p>There are some other useful arguments you’ll often find yourself supplying to <code>dagify()</code>:</p>
<ul>
<li><code>exposure</code> and <code>outcome</code>: Telling ggdag the variables that are the exposure and outcome of your research question is required for many of the most useful queries we can make of DAGs.</li>
<li><code>latent</code>: This argument lets us tell ggdag that some variables in the DAG are unmeasured. This is really useful for identifying valid adjustment sets with the data we actually have.</li>
<li><code>coords</code>: Coordinates for the variables. You can choose between algorithmic or manual layouts, as discussed in below. We’ll use <code>time_ordered_coords()</code> here.</li>
<li><code>labels</code>: A character vector of labels for the variables.</li>
</ul>
<p>Let’s create a DAG object, <code>podcast_dag</code>, that has some of these attributes, then visualize the DAG with <code>ggdag()</code>. <code>ggdag()</code> returns a ggplot object, so we can add additional layers to the plot like themes.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>podcast_dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  podcast <span class="sc">~</span> mood <span class="sc">+</span> humor <span class="sc">+</span> prepared,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  exam <span class="sc">~</span> mood <span class="sc">+</span> prepared,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">time_ordered_coords</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time point 1</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot;prepared&quot;</span>, <span class="st">&quot;humor&quot;</span>, <span class="st">&quot;mood&quot;</span>), </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time point 2</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;podcast&quot;</span>,  </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time point 3</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;exam&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;exam&quot;</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">podcast =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">exam =</span> <span class="st">&quot;exam score&quot;</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mood =</span> <span class="st">&quot;mood&quot;</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">humor =</span> <span class="st">&quot;humor&quot;</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">prepared =</span> <span class="st">&quot;prepared&quot;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(podcast_dag, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>, <span class="at">text =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>()</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-dag-podcast" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-dag-podcast-1.png" class="img-fluid" width="384" /></p>
<figcaption>Figure 5.9: Proposed DAG to answer the question: Does listening to a comedy podcast the morning before an exam improve graduate students test scores?</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-body-container">
<p>For the rest of the chapter, we’ll use <code>theme_dag()</code>, a ggplot theme from ggdag meant for DAGs.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dag</span>() <span class="sc">%+replace%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="st">&quot;mm&quot;</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
DAG coordinates
</div>
</div>
<div class="callout-body-container callout-body">
<p>You don’t need to specify coordinates to ggdag. If you don’t, it uses algorithms designed for automatic layouts. There are many such algorithms, and they focus on different aspects of the layout, e.g. the shape, the space between the nodes, minimizing how many edges cross, etc. These layout algorithms usually have a component of randomness, so it’s good to use a seed if you want to get the same result.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># no coordinates specified</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>pod_dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  podcast <span class="sc">~</span> mood <span class="sc">+</span> humor <span class="sc">+</span> prepared,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  exam <span class="sc">~</span> mood <span class="sc">+</span> prepared</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># automatically determine layouts</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>pod_dag <span class="sc">|&gt;</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>(<span class="at">text_size =</span> <span class="fl">2.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="384" /></p>
</figure>
</div>
</div>
</div>
<p>We can also ask for a specific layout, e.g. the popular Sugiyama algorithm for DAGs</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pod_dag <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>(<span class="at">layout =</span> <span class="st">&quot;sugiyama&quot;</span>, <span class="at">text_size =</span> <span class="fl">2.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="384" /></p>
</figure>
</div>
</div>
</div>
<p>For causal DAGs, the time-ordered layout algorithm is often best, which we can specify with <code>time_ordered_coords()</code> or <code>layout = "time_ordered"</code>. We’ll discuss time ordering in greater detail in <a href="#sec-time-ordered" class="quarto-xref"><span class="quarto-unresolved-ref">sec-time-ordered</span></a>. Earlier, we explicitly told ggdag which variables were at which time points, but we don’t need to. Notice, though, that the time ordering algorithm puts <code>podcast</code> and <code>exam</code> at the same timepoint since one doesn’t cause another (and thus predate it). We know that’s not the case: listening to the podcast happened before taking the exam.</p>
<!-- TODO: if implementing a better way to use this algorithm while specifying on or more time points then update this -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pod_dag <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>(<span class="at">layout =</span> <span class="st">&quot;time_ordered&quot;</span>, <span class="at">text_size =</span> <span class="fl">2.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="384" /></p>
</figure>
</div>
</div>
</div>
<p>You can also manually specify coordinates using a list or data frame and provide them to the <code>coords</code> argument of <code>dagify()</code>. Additionally, because ggdag is based on dagitty, you can use <code>dagitty.net</code> to create and organize a DAG using a graphical interface, then export the result as dagitty code for ggdag to consume.</p>
<p>Algorithmic layouts are often nice for fast visualization of DAGs or particularly complex graphs. Once you want to share your DAG, it’s usually best to be a little more intentional about the layout, perhaps by specifying the coordinates manually. <code>time_ordered_coords()</code> is often the best of both worlds, and we’ll use it for most DAGs in this book.</p>
</div>
</div>
<p>We’ve specified the DAG for this question and told ggdag what the exposure and outcome of interest are. According to the DAG, there is no direct causal relationship between listening to a podcast and exam scores. Are there any other open paths? <code>ggdag_paths()</code> takes a DAG and visualizes the open paths. In <a href="#fig-paths-podcast" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-paths-podcast</span></a>, we see two open paths: <code>podcast &lt;- mood -&gt; exam"</code> and <code>podcast &lt;- prepared -&gt; exam</code>. These are both forks—<em>confounding pathways</em>. Since there is no causal relationship between listening to a podcast and exam scores, the only open paths are <em>backdoor</em> paths, these two confounding pathways.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co">: Why aren&#39;t okabe-ito colors propgating here and other spots in ggdag?</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>podcast_dag <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># show the whole dag as a light gray &quot;shadow&quot; </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rather than just the paths</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag_paths</span>(<span class="at">shadow =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-paths-podcast" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-paths-podcast-1.png" class="img-fluid" width="672" /></p>
<figcaption>Figure 5.10: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-body-container">
<p><code>dagify()</code> returns a <code>dagitty()</code> object, but underneath the hood, ggdag converts <code>dagitty</code> objects to tidy DAGs, a structure that holds both the <code>dagitty</code> object and a <code>dataframe</code> about the DAG. This is handy if you want to manipulate the DAG programatically.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>podcast_dag_tidy <span class="ot">&lt;-</span> podcast_dag <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>podcast_dag_tidy</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A DAG with 5 nodes and 5 edges
#
# Exposure: podcast
# Outcome: exam
#
# A tibble: 7 × 9
  name         x     y direction to       xend  yend
  &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;fct&gt;     &lt;chr&gt;   &lt;int&gt; &lt;int&gt;
1 exam         3     0 &lt;NA&gt;      &lt;NA&gt;       NA    NA
2 humor        1     0 -&gt;        podcast     2     0
3 mood         1     1 -&gt;        exam        3     0
4 mood         1     1 -&gt;        podcast     2     0
5 podcast      2     0 &lt;NA&gt;      &lt;NA&gt;       NA    NA
6 prepared     1    -1 -&gt;        exam        3     0
7 prepared     1    -1 -&gt;        podcast     2     0
# ℹ 2 more variables: circular &lt;lgl&gt;, label &lt;chr&gt;</code></pre>
</div>
</div>
<p>Most of the quick plotting functions transform the <code>dagitty</code> object to a tidy DAG if it’s not already, then manipulate the data in some capacity. For instance, <code>dag_paths()</code> underlies <code>ggdag_paths()</code>; it returns a tidy DAG with data about the paths. You can use several dplyr functions on these objects directly.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>podcast_dag_tidy <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_paths</span>() <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(set <span class="sc">==</span> <span class="dv">2</span>, path <span class="sc">==</span> <span class="st">&quot;open path&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A DAG with 3 nodes and 2 edges
#
# Exposure: podcast
# Outcome: exam
#
# A tibble: 4 × 11
  set   name        x     y direction to     xend  yend
  &lt;chr&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;fct&gt;     &lt;chr&gt; &lt;int&gt; &lt;int&gt;
1 2     exam        3     0 &lt;NA&gt;      &lt;NA&gt;     NA    NA
2 2     podcast     2     0 &lt;NA&gt;      &lt;NA&gt;     NA    NA
3 2     prepar…     1    -1 -&gt;        exam      3     0
4 2     prepar…     1    -1 -&gt;        podc…     2     0
# ℹ 3 more variables: circular &lt;lgl&gt;, label &lt;chr&gt;,
#   path &lt;chr&gt;</code></pre>
</div>
</div>
<p>Tidy DAGs are not pure data frames, but you can retrieve either the <code>dataframe</code> or <code>dagitty</code> object to work with them directly using <code>pull_dag_data()</code> or <code>pull_dag()</code>. <code>pull_dag()</code> can be useful when you want to work with dagitty functions:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>podcast_dag_tidy <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull_dag</span>() <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paths</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$paths
[1] &quot;podcast &lt;- mood -&gt; exam&quot;    
[2] &quot;podcast &lt;- prepared -&gt; exam&quot;

$open
[1] TRUE TRUE</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Backdoor paths pollute the statistical association between <code>podcast</code> and <code>exam</code>, so we need to account for them. <code>ggdag_adjustment_set()</code> visualizes any valid adjustment sets implied by the DAG. <a href="#fig-podcast-adustment-set" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-podcast-adustment-set</span></a> shows variables that are adjusted for as squares. Any arrows that were coming out of adjusted variables are removed from the DAG, because the path is longer open at that variable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_adjustment_set</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  podcast_dag, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="cn">FALSE</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-podcast-adustment-set" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-podcast-adustment-set-1.png" class="img-fluid" width="384" /></p>
<figcaption>Figure 5.11: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-podcast-adustment-set" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-podcast-adustment-set</span></a> shows the <em>minimal adjustment set</em>. By default, ggdag returns the set(s) that can close all backdoor paths with the fewest number of variables possible. In this DAG, that’s just one set: <code>mood</code> and <code>prepared</code>. This makes sense, because there are two backdoor paths and the only other variables on them besides the exposure and outcome are these two variables. So, at minimum, we need to account for both to get a valid estimate.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-body-container">
<p><code>ggdag()</code> and friends usually use <code>tidy_dagitty()</code> and <code>dag_*()</code> or <code>node_*()</code> functions to change the underlying data frame. Similarly, the quick plotting functions use ggdag’s geoms to visualize the resulting DAG(s). In other words, you can use the same data manipulation and visualization strategies that you use day-to-day directly with ggdag.</p>
<p>Here’s a condensed version of what <code>ggdag_adjustment_set()</code> is doing:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>podcast_dag_tidy <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add adjustment sets to data</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dag_adjustment_sets</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, <span class="at">yend =</span> yend,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> adjusted, <span class="at">shape =</span> adjusted</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggdag&#39;s custom geoms: add nodes, edges, and labels</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_point</span>() <span class="sc">+</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove adjusted paths</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_edges_link</span>(<span class="at">data =</span> \(.df) <span class="fu">filter</span>(.df, adjusted <span class="sc">!=</span> <span class="st">&quot;adjusted&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dag_label_repel</span>() <span class="sc">+</span> </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># you can use any ggplot function, too</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> set) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">adjusted =</span> <span class="dv">15</span>, <span class="at">unadjusted =</span> <span class="dv">19</span>))</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="432" /></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Minimal adjustment sets are only one type of valid adjustment sets. Sometimes, there are other combinations of variables that can get us an unbiased effect estimate. Two other options available in ggdag are full adjustment sets and canonical adjustment sets. Full adjustment sets are are every combination of variables that result in a valid set.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_adjustment_set</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  podcast_dag, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="cn">FALSE</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get full adjustment sets</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-adustment-set-all" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-adustment-set-all-1.png" class="img-fluid" width="624" /></p>
<figcaption>Figure 5.12: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>It turns out that we can also control for <code>humor</code> without biasing the result.</p>
<p>Canonical adjusment sets are a bit more complex: they are all possible ancestors of the exposure and outcome minus any possible descendants. In fully saturated DAGs (DAGs where every node causes anything that comes after it in time), the canonical adjustment set is the minimal adjustment set.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-body-container">
<p>Most of the functions in ggdag use dagitty underneath the hood. It’s often useful to call dagitty functions directly.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(podcast_dag, <span class="at">type =</span> <span class="st">&quot;canonical&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ humor, mood, prepared }</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Using our proposed DAG, let’s simulate some data to see how accounting for the minimal adjustment set might occur in practice.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> podcast_dag <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simulate_data</span>()</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sim_data</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 500 × 5
     exam  humor   mood podcast prepared
    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1 -0.435  0.263 -0.100  -0.630   1.07  
 2 -0.593  0.317  0.143  -1.55    0.0640
 3  0.786  1.97  -0.591  -0.318  -0.439 
 4 -0.103  2.86  -0.139   1.07    0.754 
 5 -0.614 -2.39   0.702   0.464   0.356 
 6  1.01   1.21   0.910   0.769   0.561 
 7  0.167 -1.37  -0.559  -0.866   0.214 
 8  1.16   0.164 -0.743   0.969  -1.67  
 9  0.650  0.215 -0.248   0.691  -0.303 
10  0.156  0.713  1.19   -1.02   -0.219 
# ℹ 490 more rows</code></pre>
</div>
</div>
<p>Since we have simulated this data, we know that this is a case where <em>standard methods will succeed</em> (see <a href="#sec-standard" class="quarto-xref"><span class="quarto-unresolved-ref">sec-standard</span></a>) and therefore can estimate the causal effect using a basic linear regression model. <a href="#fig-dag-sim" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-dag-sim</span></a> shows a forest plot of the simulated data based on our DAG. Notice the model that only included the exposure resulted in a spurious effect (an estimate of -0.1 when we know the truth is 0), whereas the model that adjusted for the two variables as suggested by <code>ggdag_adjustment_set()</code> is not spurious (0.0).</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Model that does not close backdoor paths</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>unadjusted_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(exam <span class="sc">~</span> podcast, sim_data) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;podcast&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">formula =</span> <span class="st">&quot;podcast&quot;</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Model that closes backdoor paths</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>adjusted_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(exam <span class="sc">~</span> podcast <span class="sc">+</span> mood <span class="sc">+</span> prepared, sim_data) <span class="sc">|&gt;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;podcast&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">formula =</span> <span class="st">&quot;podcast + mood + prepared&quot;</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  unadjusted_model,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  adjusted_model</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> formula, <span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">fatten =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="dv">18</span>) <span class="sc">+</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;correct effect size: 0&quot;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="cell-output-display">
<div id="fig-dag-sim" class="quarto-figure quarto-figure-center">
<figure>
<p><img src="chapter-05_files/figure-html/fig-dag-sim-1.png" class="img-fluid" width="672" /></p>
<figcaption>Figure 5.13: Forest plot of simulated data based on the DAG described in <a href="#fig-dag-podcast" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-dag-podcast</span></a></figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="structures-of-causality" class="level2" data-number="5.3">
<h2 data-number="5.3"><span class="header-section-number">5.3</span> Structures of Causality</h2>
<section id="advanced-confounding" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1"><span class="header-section-number">5.3.1</span> Advanced Confounding</h3>
<p>In <code>podcast_dag</code>, <code>mood</code> and <code>prepared</code> were <em>direct</em> confounders: there was an arrow going directly from them to <code>podcast</code> and <code>exam</code>. Often, backdoor paths are more complex. Let’s consider such a case by adding two new variables: <code>alertness</code> and <code>skills_course</code>. <code>alertness</code> represents the feeling of alertness from a good mood, thus the arrow going from <code>mood</code> to <code>alertness</code>. <code>skills_course</code> represents whether the student took a College Skills Course and learned time management techniques. Now, <code>skills_course</code> is what frees up the time to listen to a podcast as well as being prepared for the exam. <code>mood</code> and <code>prepared</code> are no longer direct confounders: they are two variables along a more complex backdoor path. Additionally, we’ve added an arrow going from <code>humor</code> to <code>mood</code>. Let’s take a look.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>podcast_dag2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    podcast <span class="sc">~</span> mood <span class="sc">+</span> humor <span class="sc">+</span> skills_course,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    alertness <span class="sc">~</span> mood,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    mood <span class="sc">~</span> humor,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    prepared <span class="sc">~</span> skills_course,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    exam <span class="sc">~</span> alertness <span class="sc">+</span> prepared,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">time_ordered_coords</span>(),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">&quot;exam&quot;</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">podcast =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">exam =</span> <span class="st">&quot;exam score&quot;</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">mood =</span> <span class="st">&quot;mood&quot;</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">alertness =</span> <span class="st">&quot;alertness&quot;</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">skills_course =</span> <span class="st">&quot;college</span><span class="sc">\n</span><span class="st">skills course&quot;</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">humor =</span> <span class="st">&quot;humor&quot;</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">prepared =</span> <span class="st">&quot;prepared&quot;</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(podcast_dag2, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>, <span class="at">text =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>Now there are <em>three</em> backdoor paths we need to close: <code>podcast &lt;- humor -&gt; mood -&gt; alertness -&gt; exam</code>, <code>podcast &lt;- mood -&gt; alertness -&gt; exam</code>, and<code>podcast &lt;- skills_course -&gt; prepared -&gt; exam</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_paths</span>(podcast_dag2, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">shadow =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>There are 4 to close all three paths (and 18 full adjustment sets!). The minimal adjustment sets are <code>alertness + prepared</code>, <code>alertness + skills_course</code>, <code>mood + prepared</code>, <code>mood + skills_course</code>. We can now block the open paths in several ways. <code>mood</code> and <code>prepared</code> still work, but we’ve got other options, now. Notably, <code>prepared</code> and <code>alertness</code> could happen at the same time or even after <code>podcast</code>. <code>skills_course</code> and <code>mood</code> still happen before both <code>podcast</code> and <code>exam</code>, so the idea is still the same: the confounding pathway starts before the exposure and outcome.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag_adjustment_set</span>(podcast_dag2, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>, <span class="at">text =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>Deciding between these adjustment sets is a matter of judgment: if all data are perfectly measured, the DAG is correct, and we’ve modeled them correctly, then it doesn’t matter which we use. Each adjustment set will result in an unbiased estimate. All three of those assumptions are usually untrue to some degree. Let’s consider the path via <code>skills_course</code> and <code>prepared</code>. It may be that we are better able to assess whether or not someone took the College Skills Course than how prepared for the exam they are. In that case, an adjustment set with <code>skills_course</code> is a better option. But perhaps we better understand the relationship between preparedness and exam results. If we have it measured, controlling for that might be better. We could get the best of both worlds by including both variables: between the better measurement of <code>skills_course</code> and the better modeling of <code>prepared</code>, we might have a better chance of minimizing confounding from this path.</p>
</section>
<section id="selection-bias-and-mediation" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2"><span class="header-section-number">5.3.2</span> Selection Bias and Mediation</h3>
<p>Selection bias is another name for the type of bias that is induced by adjusting for a collider. It’s called “selection bias” because a common form of collider-induced bias is a variable that is inherently stratified upon by the design of the study. Let’s consider a case based on the original <code>podcast_dag</code> but with one additional variable: whether or not the student showed up to the exam. Now there is an indirect effect of <code>podcast</code> on <code>exam</code>: listening to a podcast influences whether or not the students showed up for the exam. The true result of <code>exam</code> is missing for those who didn’t show up; by studying the group of people who <em>did</em> show up, we are inherently stratifying on this variable.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>podcast_dag3 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  podcast <span class="sc">~</span> mood <span class="sc">+</span> humor <span class="sc">+</span> prepared,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  exam <span class="sc">~</span> mood <span class="sc">+</span> prepared <span class="sc">+</span> showed_up,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  showed_up <span class="sc">~</span> podcast <span class="sc">+</span> mood <span class="sc">+</span> prepared,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">time_ordered_coords</span>(</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time point 1</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot;prepared&quot;</span>, <span class="st">&quot;humor&quot;</span>, <span class="st">&quot;mood&quot;</span>), </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time point 2</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;podcast&quot;</span>,  </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;showed_up&quot;</span>,  </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time point 3</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;exam&quot;</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;exam&quot;</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">podcast =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">exam =</span> <span class="st">&quot;exam score&quot;</span>,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">mood =</span> <span class="st">&quot;mood&quot;</span>,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">humor =</span> <span class="st">&quot;humor&quot;</span>,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">prepared =</span> <span class="st">&quot;prepared&quot;</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">showed_up =</span> <span class="st">&quot;showed up&quot;</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(podcast_dag3, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>, <span class="at">text =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>The problem is that <code>showed_up</code> is both a collider and a mediator: stratifying on it induces a relationship between many of the variables in the DAG but blocks the the indirect effect of <code>podcast</code> on <code>exam</code>. Luckily, the adjustment sets can take care of the first problem; because <code>showed_up</code> happens <em>before</em> <code>exam</code>, we’re less at risk of collider bias between the exposure and outcome. Unfortunately, we no have no way to calculate the total effect of <code>podcast</code> on <code>exam</code> because part of the effect is missing: the indirect effect is closed at <code>showed_up</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>podcast_dag3 <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjust_for</span>(<span class="st">&quot;showed_up&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag_adjustment_set</span>()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dag_adjustment_sets(., exposure = exposure, outcome = outcome, : Failed to close backdoor paths. Common reasons include:
            * graph is not acyclic
            * backdoor paths are not closeable with given set of variables
            * necessary variables are unmeasured (latent)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>Sometimes, you can still estimate effects in this situation by changing the estimate you wish to calculate. We can’t calculate the total effect because we are missing the indirect effect, but we can still calculate the direct effect of <code>podcast</code> on <code>exam</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>podcast_dag3 <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjust_for</span>(<span class="st">&quot;showed_up&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag_adjustment_set</span>(<span class="at">effect =</span> <span class="st">&quot;direct&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
</section>
</section>
<section id="m-bias-and-butterfly-bias" class="level2" data-number="5.4">
<h2 data-number="5.4"><span class="header-section-number">5.4</span> M-Bias and Butterfly Bias</h2>
<p>A special case of selection bias that you’ll often see people talk about is <em>M-bias</em>. It’s called M-bias because it looks like an M when arranges top to bottom.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">m_bias</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-body-container">
<p>ggdag has a number of quick-DAGs for demonstrating basic causal structures including <code>confounder_triangle()</code>, <code>collider_triangle()</code>, <code>m_bias()</code>, and <code>butterfly_bias()</code>.</p>
</div>
</div>
</div>
<p>What’s theoretically interesting about M-bias is that <code>m</code> is a collider but occurs before <code>x</code> and <code>y</code>. Remember that association is blocked at a collider, so there is no open path between <code>x</code> and <code>y</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paths</span>(<span class="fu">m_bias</span>())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$paths
[1] &quot;x &lt;- a -&gt; m &lt;- b -&gt; y&quot;

$open
[1] FALSE</code></pre>
</div>
</div>
<p>Let’s focus on the <code>mood</code> path of the podcast-exam DAG. What if we were wrong about mood, and the actual relationship was M-shaped? Let’s say that, rather than causing <code>podcast</code> and <code>exam</code>, mood was itself caused by two mutual causes of <code>podcast</code> and <code>exam</code>, <code>u1</code> and <code>u2</code>. We don’t know what <code>u1</code> and <code>u2</code> are, and we don’t have them measured. As above, there are no open paths in this subset of the DAG.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>podcast_dag4 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  podcast <span class="sc">~</span> u1,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  exam <span class="sc">~</span> u2,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  mood <span class="sc">~</span> u1 <span class="sc">+</span> u2,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">time_ordered_coords</span>(<span class="fu">list</span>(</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;u1&quot;</span>, <span class="st">&quot;u2&quot;</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;mood&quot;</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;podcast&quot;</span>, </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;exam&quot;</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;exam&quot;</span>,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">podcast =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">exam =</span> <span class="st">&quot;exam score&quot;</span>,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">mood =</span> <span class="st">&quot;mood&quot;</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">u1 =</span> <span class="st">&quot;unmeasured&quot;</span>,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">u2 =</span> <span class="st">&quot;unmeasured&quot;</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we don&#39;t have them measured</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">latent =</span> <span class="fu">c</span>(<span class="st">&quot;u1&quot;</span>, <span class="st">&quot;u2&quot;</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(podcast_dag4, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>, <span class="at">text =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>The problem arises when we think our original DAG is the right DAG: <code>mood</code> is in the adjustment set, so we control for it. But this induces bias! It opens up a path between <code>u1</code> and <code>u2</code>, thus creating a path from <code>podcast</code> to <code>exam</code>. If we had either <code>u1</code> or <code>u2</code> measured, we could adjust for them to close this path, but we don’t. There’s no way to close this open path.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>podcast_dag4 <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adjust_for</span>(<span class="st">&quot;mood&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag_adjustment_set</span>(<span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>, <span class="at">text =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dag_adjustment_sets(., exposure = exposure, outcome = outcome, : Failed to close backdoor paths. Common reasons include:
            * graph is not acyclic
            * backdoor paths are not closeable with given set of variables
            * necessary variables are unmeasured (latent)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values
(`geom_label_repel()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>Of course, the best thing to do here is not control for <code>mood</code> at all. Sometimes, though, that is not an option. Imagine if, instead of <code>mood</code>, this turned out to be the real structure for <code>showed_up</code>: since we are inherently controlling for <code>showed_up</code>, and we don’t have the unmeasured variables, our study results will always be biased. It’s important to understand if we’re in that situation so we can address it with sensitivity analysis to understand just how biased the effect would be.</p>
<p>Let’s consider a variation on M-bias where <code>mood</code> causes <code>podcast</code> and <code>exam</code> and <code>u1</code> and <code>u2</code> are mutual causes of <code>mood</code> and the exposure and outcome. This is sometimes called butterfly or bowtie bias, again because of its shape.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">butterfly_bias</span>(<span class="at">x =</span> <span class="st">&quot;podcast&quot;</span>, <span class="at">y =</span> <span class="st">&quot;exam&quot;</span>, <span class="at">m =</span> <span class="st">&quot;mood&quot;</span>, <span class="at">a =</span> <span class="st">&quot;u1&quot;</span>, <span class="at">b =</span> <span class="st">&quot;u2&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>(<span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>Now, we’re in a tough position: we need to control for <code>mood</code> because it’s a confounder, but controlling for <code>mood</code> opens up the pathway from <code>u1</code> to <code>u2</code>. Because we don’t have either variable measured, we can’t then close the path opened from conditioning on <code>mood</code>. What should we do? It turns out that, when in doubt, controlling for <code>mood</code> is the better of the two options: confounding bias tends to be worse than collider bias, and M-shaped structures of colliders are very sensitive (e.g., a slight deviation from the M structure reduces the bias overall).</p>
<p>Another common form of selection bias is from <em>loss to follow-up</em>: people drop out of a study in a way that is related to the exposure and outcome. We’ll come back to this topic in <a href="#sec-TODO" class="quarto-xref"><span class="quarto-unresolved-ref">sec-TODO</span></a>.</p>
</section>
<section id="causes-of-the-exposure-causes-of-the-outcome" class="level2" data-number="5.5">
<h2 data-number="5.5"><span class="header-section-number">5.5</span> Causes of the exposure, causes of the outcome</h2>
<p>Let’s consider one other type of causal structure that’s important: causes of the exposure and not the outcome, and their opposites, causes of the outcome and not the exposure. Let’s add a variable, <code>grader_mood</code>, to the original DAG.</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>podcast_dag5 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  podcast <span class="sc">~</span> mood <span class="sc">+</span> humor <span class="sc">+</span> prepared,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  exam <span class="sc">~</span> mood <span class="sc">+</span> prepared <span class="sc">+</span> grader_mood,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">time_ordered_coords</span>(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time point 1</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot;prepared&quot;</span>, <span class="st">&quot;humor&quot;</span>, <span class="st">&quot;mood&quot;</span>), </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time point 2</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">&quot;podcast&quot;</span>, <span class="st">&quot;grader_mood&quot;</span>),  </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># time point 3</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;exam&quot;</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;exam&quot;</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">podcast =</span> <span class="st">&quot;podcast&quot;</span>,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">exam =</span> <span class="st">&quot;exam score&quot;</span>,</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mood =</span> <span class="st">&quot;student</span><span class="sc">\n</span><span class="st">mood&quot;</span>,</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">humor =</span> <span class="st">&quot;humor&quot;</span>,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">prepared =</span> <span class="st">&quot;prepared&quot;</span>,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">grader_mood =</span> <span class="st">&quot;grader</span><span class="sc">\n</span><span class="st">mood&quot;</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(podcast_dag5, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>, <span class="at">text =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>There are now two variables that aren’t related to <em>both</em> the exposure and the outcome: <code>humor</code>, which causes <code>podcast</code> but not <code>exam</code>, and <code>grader_mood</code>, which causes <code>exam</code> but not <code>podcast</code>. Let’s start with <code>humor</code>.</p>
<p>Variables that cause the exposure but not the outcome are also called <em>instrumental variables</em> (IVs). IVs are an unusual circumstance where, under certain conditions, controlling for them can make other types of bias worse. What’s unusual about this is that IVs can <em>also</em> be used to conduct an entirely different approach to estimating an unbiased effect of the exposure on the outcome. IVs are commonly used this way in econometrics and are increasingly popular in other areas. In short, IV analysis allows us to estimate the causal effect using a different set of assumptions than the approaches we’ve talked about thus far. Sometimes, a problem that is intractible using propensity score methods is possible to address using IVs and vice versa. We’ll talk more about IVs in <a href="#sec-TODO" class="quarto-xref"><span class="quarto-unresolved-ref">sec-TODO</span></a>.</p>
<p>So, if you’re <em>not</em> using IV methods, should you include an IV in a model meant to address confounding? If you’re not sure if the variable is an IV or not, you should probably add it to your model: it’s more likely to be a confounder than an IV, and, it turns out, the bias from adding an IV is usually small in practice. So, like adjusting for a potential M-structure variable, the risk of bias is worse from confounding.</p>
<p>Now let’s talk about the opposite of an IV: a cause of the outcome that is not the cause of the exposure. These variables are sometimes called <em>competing exposures</em> (because they also cause the outcome) or <em>precision variables</em> (because, as we’ll see, the increase the precision of causal estimates). We’ll call them precision variables because we’re concerned about the relationship to the research question at hand, not to another research question where they are exposures.</p>
<p>Like IVs, precision variables do not occur along paths from the exposure to the outcome. Thus, including them is not necessary. Unlike IVs, including precision variables is beneficial. Including other causes of the outcomes helps a statistical model capture some of its variation. This doesn’t impact the point estimate of the effect, but it does reduce the variance, resulting in smaller standard errors and narrower confidence intervals. Thus, we recommend including them when possible.</p>
<p>So, even though we don’t need to control for <code>grader_mood</code>, if we have it in the data set, we should. Similarly, <code>humor</code> is not a good addition to the model unless we think it really might be a confounder; if it is a true instrument, we might want to consider using IV methods to estimate the effect, instead.</p>
</section>
<section id="recommendations-in-building-dags" class="level2" data-number="5.6">
<h2 data-number="5.6"><span class="header-section-number">5.6</span> Recommendations in building DAGs</h2>
<p>In principle, using DAGs is easy: you specify the causal relationships you think exist and then query the DAG for information like valid adjustment sets. In practice, assembling DAGs takes considerable time and thought. In fact, next to defining the research question itself, it’s one of the hardest steps in making causal inferences. Very little guidance exists on best practices in assembling DAGs. <span class="citation" data-cites="Tennant2021">Tennant et al. (<a href="#ref-Tennant2021" role="doc-biblioref">2020</a>)</span> collected data on DAGs in applied health research to better understand how they were being used. <a href="#tbl-dag-properties" class="quarto-xref">Table <span class="quarto-unresolved-ref">tbl-dag-properties</span></a> shows some information they collected: the median number of nodes and arcs in a DAG, their ration, the saturation percent of the DAG, and how many were fully saturated. Saturating DAGs means adding all possible arrows going forward in time, e.g. in a fully saturated DAG, any given variable at time point 1 has arrows going to all variables in future time points, and so on. Most DAGs were only about half saturated and very few were fully saturated.</p>
<p>Only about half of the papers using DAGs reported the adjustment set used. In other words, researchers presented their assumptions about the research question but not the implications about how they should handle the modeling stage or if in fact they did use a valid adjustment set. Similarly, the majority of studies did not report the estimand of interest.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-body-container">
<p>The estimand is the target of interest in terms of what it is we’re trying to estimate, as discussed briefly in <a href="#sec-whole-game" class="quarto-xref">Chapter <span class="quarto-unresolved-ref ref-noprefix">sec-whole-game</span></a>. We’ll discuss estimands in detail in <a href="#sec-estimands" class="quarto-xref">Chapter <span class="quarto-unresolved-ref ref-noprefix">sec-estimands</span></a>.</p>
</div>
</div>
</div>
<div id="tbl-dag-properties" class="cell tbl-parent">
<div class="cell-output-display">
<div id="kwsxntypwf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kwsxntypwf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kwsxntypwf thead, #kwsxntypwf tbody, #kwsxntypwf tfoot, #kwsxntypwf tr, #kwsxntypwf td, #kwsxntypwf th {
  border-style: none;
}

#kwsxntypwf p {
  margin: 0;
  padding: 0;
}

#kwsxntypwf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kwsxntypwf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kwsxntypwf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kwsxntypwf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kwsxntypwf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kwsxntypwf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kwsxntypwf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kwsxntypwf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kwsxntypwf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kwsxntypwf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kwsxntypwf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kwsxntypwf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kwsxntypwf .gt_spanner_row {
  border-bottom-style: hidden;
}

#kwsxntypwf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kwsxntypwf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kwsxntypwf .gt_from_md > :first-child {
  margin-top: 0;
}

#kwsxntypwf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kwsxntypwf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kwsxntypwf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kwsxntypwf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kwsxntypwf .gt_row_group_first td {
  border-top-width: 2px;
}

#kwsxntypwf .gt_row_group_first th {
  border-top-width: 2px;
}

#kwsxntypwf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kwsxntypwf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kwsxntypwf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kwsxntypwf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kwsxntypwf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kwsxntypwf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kwsxntypwf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kwsxntypwf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kwsxntypwf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kwsxntypwf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kwsxntypwf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kwsxntypwf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kwsxntypwf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kwsxntypwf .gt_left {
  text-align: left;
}

#kwsxntypwf .gt_center {
  text-align: center;
}

#kwsxntypwf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kwsxntypwf .gt_font_normal {
  font-weight: normal;
}

#kwsxntypwf .gt_font_bold {
  font-weight: bold;
}

#kwsxntypwf .gt_font_italic {
  font-style: italic;
}

#kwsxntypwf .gt_super {
  font-size: 65%;
}

#kwsxntypwf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kwsxntypwf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kwsxntypwf .gt_indent_1 {
  text-indent: 5px;
}

#kwsxntypwf .gt_indent_2 {
  text-indent: 10px;
}

#kwsxntypwf .gt_indent_3 {
  text-indent: 15px;
}

#kwsxntypwf .gt_indent_4 {
  text-indent: 20px;
}

#kwsxntypwf .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th id="&lt;strong&gt;Characteristic&lt;/strong&gt;" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="&lt;strong&gt;N = 144&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>N = 144</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="2" id="&lt;strong&gt;DAG properties&lt;/strong&gt;" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup"><strong>DAG properties</strong></td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="dag_prop  label">Number of Nodes</td>
<td class="gt_row gt_center" headers="dag_prop  stat_0">12 (9, 16)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="dag_prop  label">Number of Arcs</td>
<td class="gt_row gt_center" headers="dag_prop  stat_0">29 (19, 41)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="dag_prop  label">Node to Arc Ratio</td>
<td class="gt_row gt_center" headers="dag_prop  stat_0">2.30 (1.78, 3.00)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="dag_prop  label">Saturation Proportion</td>
<td class="gt_row gt_center" headers="dag_prop  stat_0">0.46 (0.31, 0.67)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="dag_prop  label">Fully Saturated</td>
<td class="gt_row gt_center" headers="dag_prop  stat_0"><br />
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="dag_prop  label">    Yes</td>
<td class="gt_row gt_center" headers="dag_prop  stat_0">4 (3%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="dag_prop  label">    No</td>
<td class="gt_row gt_center" headers="dag_prop  stat_0">140 (97%)</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="2" id="&lt;strong&gt;Reporting&lt;/strong&gt;" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup"><strong>Reporting</strong></td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_left" headers="reporting  label">Reported Estimand</td>
<td class="gt_row gt_center" headers="reporting  stat_0"><br />
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="reporting  label">    Yes</td>
<td class="gt_row gt_center" headers="reporting  stat_0">40 (28%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="reporting  label">    No</td>
<td class="gt_row gt_center" headers="reporting  stat_0">104 (72%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="reporting  label">Reported Adjustment Set</td>
<td class="gt_row gt_center" headers="reporting  stat_0"><br />
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="reporting  label">    Yes</td>
<td class="gt_row gt_center" headers="reporting  stat_0">80 (56%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="reporting  label">    No</td>
<td class="gt_row gt_center" headers="reporting  stat_0">64 (44%)</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="even">
<td colspan="2" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> Median (IQR); n (%)</td>
</tr>
</tfoot>

</table>

</div>
</div>
<p><strong>?(caption)</strong></p>
</div>
<p>In this section, we’ll offer some advice from <span class="citation" data-cites="Tennant2021">Tennant et al. (<a href="#ref-Tennant2021" role="doc-biblioref">2020</a>)</span> and our own experience assembling DAGs.</p>
<section id="iterate-early-and-often" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1"><span class="header-section-number">5.6.1</span> Iterate early and often</h3>
<p>One of the best things you can do for the quality of your results is to make the DAG before you conduct the study, ideally before you even collect the data. If you’re already working with your data, at minimum build your DAG prior to doing data analysis. This advice is similar in spirit to pre-registered analysis plans: declaring your assumptions ahead of time can help clarify what you need to do, reduce risk of overfitting (e.g., determining confounders incorrectly from the data), and give you time to get feedback on your DAG.</p>
<p>This last benefit is particularly important: you should ideally democratize your DAG. Share it early and often with others who are experts on the data, domain, and models. It’s natural to create a DAG, present it to your colleagues, and realize you have missed something important. Sometimes you won’t agree on every detail of the structure. That’s a good thing: you know now where there is uncertainty in your DAG. You can then examine the results from more than one plausible DAG or address the uncertainty with sensitivity analyses.</p>
<p>If you have more than one candidate DAG, it might be useful to check their adjustment sets. If two DAGs have overlapping adjustment sets, focus on those sets; then, you can move forward in a way that satisfies the plausible assumptions you have.</p>
</section>
<section id="consider-your-question" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2"><span class="header-section-number">5.6.2</span> Consider your question</h3>
<p>As we saw in <a href="#fig-COLLIDER-MEDIATION-TODO" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-COLLIDER-MEDIATION-TODO</span></a>, some questions can be difficult to answer with certain data, while others are more approachable. You should consider exactly what it is you want to estimate. This is an important topic and the subject of <a href="#sec-estimands" class="quarto-xref">Chapter <span class="quarto-unresolved-ref ref-noprefix">sec-estimands</span></a>.</p>
<p>Another important detail about how your DAG relates to your question is the population and time. Many causal structures are not static over time and space. Consider lung cancer: the distribution of causes of lung cancer was considerably different before the spread of smoking. In medieval Japan, prior to the spread of tobacco from the Americas centuries later, the causal structure for lung cancer would have been practically different to what it is in Japan today, both in terms of tobacco use and other factors (age of the population, etc.)</p>
<p>The same is true for confounders. Even if something <em>can</em> cause the exposure and outcome, if the prevalence of that thing is zero in the population you’re analyzing, it’s irrelevant to the causal question. It may also be that, in some populations, it doesn’t affect one of the two. The reverse is, of course, also true: there might be something unique to the target population. The use of tobacco in North America several centuries ago was unique among the world population, even though ceremonial tobacco use was quite different from modern recreational use. Many changes won’t happen as dramatically as across centuries, but sometimes, they do, e.g. if regulation in one country effectively eliminates the population exposure to something.</p>
</section>
<section id="chapter-05-sec-time-ordered" class="level3" data-number="5.6.3">
<h3 data-number="5.6.3"><span class="header-section-number">5.6.3</span> Order nodes by time</h3>
<p>As we discussed earlier, we recommend ordering your variables by time, either left-to-right or up-to-down. There are two reasons for this. First, time ordering is an important part of your assumptions. After all, something happening before another thing is a requirement for it to be a cause. Thinking this through carefully will clarify your DAG and the variables you need to address.</p>
<p>Second, after a certain level of complexity, it’s easier to read a DAG when it is arranged by time because you have to think less about that dimension; it’s inherent to the layout. The time ordering algorithm in ggdag automates much of this for you, although as we saw earlier, it’s sometimes helpful to give it more information about the order.</p>
<p>A related topic is feedback loops. Often we think about two things that mutually cause each other as happening in a circle, like global warming and A/C use (A/C use increases global warming, which makes it hotter, which increases A/C use, and so on). It’s tempting to visualize that relationship like this:</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  ac_use <span class="sc">~</span> global_temp,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  global_warming <span class="sc">~</span> ac_use,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">ac_use =</span> <span class="st">&quot;A/C use&quot;</span>, <span class="at">global_warming =</span> <span class="st">&quot;Global</span><span class="sc">\n</span><span class="st">temperature&quot;</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>(<span class="at">layout =</span> <span class="st">&quot;circle&quot;</span>, <span class="at">edge_type =</span> <span class="st">&quot;arc&quot;</span>, <span class="at">text =</span> <span class="cn">FALSE</span>, <span class="at">use_labels =</span> <span class="st">&quot;label&quot;</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values
(`geom_label_repel()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="336" /></p>
</div>
</div>
<p>From a DAG perspective, this is a problem because of the <em>A</em> part of <em>DAG</em>: it’s cyclic! Importantly, though, it’s also not correct from a causal perspective. Feedback loops are a shorthand for what really happens, which is that the two variables mutually affect each other <em>over time</em>. Causality only goes forward in time, so it doesn’t make since for it to go back and forth like in <a href="#fig-TODO" class="quarto-xref">Figure <span class="quarto-unresolved-ref">fig-TODO</span></a>.</p>
<p>The real DAG looks something like this:</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  global_temp_2000 <span class="sc">~</span> ac_use_1990,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  ac_use_2000 <span class="sc">~</span> global_temp_1990,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  global_temp_2010 <span class="sc">~</span> ac_use_2000,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  ac_use_2010 <span class="sc">~</span> global_temp_2000,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  global_temp_2020 <span class="sc">~</span> ac_use_2010,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  ac_use_2020 <span class="sc">~</span> global_warming_2010,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">time_ordered_coords</span>(),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ac_use_1990 =</span> <span class="st">&quot;A/C use&quot;</span>, </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">global_warming_1990 =</span> <span class="st">&quot;Global</span><span class="sc">\n</span><span class="st">temperature&quot;</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">ac_use_2000 =</span> <span class="st">&quot;A/C use&quot;</span>, </span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">global_warming_2000 =</span> <span class="st">&quot;Global</span><span class="sc">\n</span><span class="st">temperature&quot;</span>,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">ac_use_2010 =</span> <span class="st">&quot;A/C use&quot;</span>, </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">global_warming_2010 =</span> <span class="st">&quot;Global</span><span class="sc">\n</span><span class="st">temperature&quot;</span>,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ac_use_2020 =</span> <span class="st">&quot;A/C use&quot;</span>, </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">global_warming_2020 =</span> <span class="st">&quot;Global</span><span class="sc">\n</span><span class="st">temperature&quot;</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggdag</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="chapter-05_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<ul>
<li>Time ordering algorithm</li>
<li>Feedback loops: global warming and A/C use</li>
</ul>
</section>
<section id="consider-the-whole-data-collection-process" class="level3" data-number="5.6.4">
<h3 data-number="5.6.4"><span class="header-section-number">5.6.4</span> Consider the whole data collection process</h3>
<ul>
<li>race/shooting (show the <code>effect</code> argument of <code>adjustmentSets</code> to get direct effect)</li>
<li>healthy worker bias</li>
</ul>
</section>
<section id="include-variables-you-dont-have" class="level3" data-number="5.6.5">
<h3 data-number="5.6.5"><span class="header-section-number">5.6.5</span> Include variables you don’t have</h3>
<ul>
<li>Examples where you can and can’t adjust depending</li>
</ul>
</section>
<section id="saturate-your-dag-then-prune" class="level3" data-number="5.6.6">
<h3 data-number="5.6.6"><span class="header-section-number">5.6.6</span> Saturate your DAG then prune</h3>
</section>
<section id="include-instruments-and-competing-exposures" class="level3" data-number="5.6.7">
<h3 data-number="5.6.7"><span class="header-section-number">5.6.7</span> Include instruments and competing exposures</h3>
</section>
<section id="focus-on-the-causal-structure-then-consider-measurement-bias" class="level3" data-number="5.6.8">
<h3 data-number="5.6.8"><span class="header-section-number">5.6.8</span> Focus on the causal structure, then consider measurement bias</h3>
</section>
<section id="be-accurate-but-focus-on-clarity" class="level3" data-number="5.6.9">
<h3 data-number="5.6.9"><span class="header-section-number">5.6.9</span> Be accurate, but focus on clarity</h3>
</section>
<section id="pick-adjustment-sets-most-likely-to-be-succesful" class="level3" data-number="5.6.10">
<h3 data-number="5.6.10"><span class="header-section-number">5.6.10</span> Pick adjustment sets most likely to be succesful</h3>
<ul>
<li>measurement error, certainty</li>
<li>use the path with the most observed variables</li>
</ul>
</section>
<section id="use-robustness-checks" class="level3" data-number="5.6.11">
<h3 data-number="5.6.11"><span class="header-section-number">5.6.11</span> Use robustness checks</h3>
<ul>
<li>Negative controls/Falsification end-points, dag-data consitency, alternate adjustment sets</li>
</ul>
</section>
</section>
<section id="chapter-05-sec-quartets" class="level2" data-number="5.7">
<h2 data-number="5.7"><span class="header-section-number">5.7</span> Causal Inference is not (just) a statistical problem</h2>
<ul>
<li>This may be better off as the next chapter</li>
</ul>
<section id="chapter-05-sec-causal-pred-revisit" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1"><span class="header-section-number">5.7.1</span> Causal and Predictive Models, Revisited</h3>
<ul>
<li>Probably too long, but if possible, condense to a popout</li>
<li>DAGs showing examples where prediction can lean on measured confounders, colliders. It’s the amount of information a variable brings, not whether the coeffecient is unbiased affect of variable on outcome.</li>
<li>Not practical to fit a prediction model with future variable</li>
<li>Table 2 Bias examples. Unmeasure confounding of Z-Y relationship. Mediation example.</li>
</ul>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">Causal Inference in R</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Causal Inference in R</span> <span class="hidden" data-render-id="quarto-int-next"><span class="chapter-number">6</span>  <span class="chapter-title">Preparing data to answer causal questions</span></span> <span class="hidden" data-render-id="quarto-int-prev"><span class="chapter-number">4</span>  <span class="chapter-title">Target Trials and Standard Methods</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/index.html">Preface</span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-1">Asking Causal Questions</span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-01.html"><span class="chapter-number">1</span>  <span class="chapter-title">What is a causal question?</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-02.html"><span class="chapter-number">2</span>  <span class="chapter-title">The whole game: mosquito nets and malaria</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-03.html"><span class="chapter-number">3</span>  <span class="chapter-title">Estimating counterfactuals</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-04.html"><span class="chapter-number">4</span>  <span class="chapter-title">Target Trials and Standard Methods</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-05.html"><span class="chapter-number">5</span>  <span class="chapter-title">Expressing causal questions as DAGs</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-2">The Design Phase</span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-06.html"><span class="chapter-number">6</span>  <span class="chapter-title">Preparing data to answer causal questions</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-07.html"><span class="chapter-number">7</span>  <span class="chapter-title">Building propensity score models</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-08.html"><span class="chapter-number">8</span>  <span class="chapter-title">Using the propensity score</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-09.html"><span class="chapter-number">9</span>  <span class="chapter-title">Evaluating your propensity score model</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:quarto-sidebar-section-3">Estimating Causal Effects</span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-10.html"><span class="chapter-number">10</span>  <span class="chapter-title">Causal estimands</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-11.html"><span class="chapter-number">11</span>  <span class="chapter-title">Fitting the outcome model</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-12.html"><span class="chapter-number">12</span>  <span class="chapter-title">Continuous exposures</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-13.html"><span class="chapter-number">13</span>  <span class="chapter-title">Categorical exposures</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-14.html"><span class="chapter-number">14</span>  <span class="chapter-title">Missingness</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-15.html"><span class="chapter-number">15</span>  <span class="chapter-title">G-Computation</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-16.html"><span class="chapter-number">16</span>  <span class="chapter-title">Causal survival analysis</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-17.html"><span class="chapter-number">17</span>  <span class="chapter-title">Causal mediation analysis</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-18.html"><span class="chapter-number">18</span>  <span class="chapter-title">Sensitivity analysis</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/chapter-19.html"><span class="chapter-number">19</span>  <span class="chapter-title">Other approaches to causal inference</span></span> <span class="hidden" data-render-id="quarto-int-sidebar:/chapters/references-99.html">References</span> <span class="hidden" data-render-id="quarto-breadcrumbs-cdeb204294862873f53ac1f4605f4769">Asking Causal Questions</span> <span class="hidden" data-render-id="quarto-breadcrumbs-68f14a829d2dd74ae11444fc89138464"><span class="chapter-number">5</span>  <span class="chapter-title">Expressing causal questions as DAGs</span></span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">Causal Inference in R - <span id="sec-dags" class="quarto-section-identifier"><span class="chapter-number">5</span>  <span class="chapter-title">Expressing causal questions as DAGs</span></span></span> <span class="hidden" data-render-id="quarto-twittercardtitle">Causal Inference in R - <span id="sec-dags" class="quarto-section-identifier"><span class="chapter-number">5</span>  <span class="chapter-title">Expressing causal questions as DAGs</span></span></span> <span class="hidden" data-render-id="quarto-ogcardtitle">Causal Inference in R - <span id="sec-dags" class="quarto-section-identifier"><span class="chapter-number">5</span>  <span class="chapter-title">Expressing causal questions as DAGs</span></span></span> <span class="hidden" data-render-id="quarto-metasitename">Causal Inference in R</span> <span class="hidden" data-render-id="quarto-twittercarddesc"></span> <span class="hidden" data-render-id="quarto-ogcardddesc"></span></p>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-hernan2021" class="csl-entry" role="listitem">
Hernán, M. A., and J. M. Robins. 2021. <em>Causal Inference: What If?</em> Boca Raton: Chapman Hall/CRC.
</div>
<div id="ref-Tennant2021" class="csl-entry" role="listitem">
Tennant, Peter W G, Eleanor J Murray, Kellyn F Arnold, Laurie Berrie, Matthew P Fox, Sarah C Gadd, Wendy J Harrison, et al. 2020. <span>“Use of Directed Acyclic Graphs (DAGs) to Identify Confounders in Applied Health Research: Review and Recommendations.”</span> <em>International Journal of Epidemiology</em> 50 (2): 620–32. <a href="https://doi.org/10.1093/ije/dyaa213">https://doi.org/10.1093/ije/dyaa213</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a  href="/chapters/chapter-04.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class='chapter-number'>4</span>  <span class='chapter-title'>Target Trials and Standard Methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a  href="/chapters/chapter-06.html" class="pagination-link">
        <span class="nav-page-text"><span class='chapter-number'>6</span>  <span class='chapter-title'>Preparing data to answer causal questions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->

</body>

</html>
